<!doctype html>
<html>

<head>
    <title>Let's Chat!</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        $(document).ready(function() {
            var socket = io();
            $("#messageSubmit").hide();
            $("form").submit(function(event) {
                event.preventDefault();
            });
            $("#userName").submit(function() {
                socket.emit("join", $("#name").val());
                console.log('user', $("#name"));
                $("#messageSubmit").show();
                $("#userName").hide();
            })
            $("#messageSubmit").submit(function() {
                socket.emit("newMessage", $("#theMessage").val());
                console.log('new message: ', $("#theMessage"));
                $("#messageSubmit").each(function() {
                    this.reset();
                });
            })
            socket.on("userUpdate", function(user) {
                console.log(user);
                $("#activityLog").append("<li>" + user + "</li>");
            })
            socket.on("newMessage", function(msg) {
                console.log(msg);
                $('#messages').append("<li>" + msg.user + ": " + msg.message + "</li>");
            })
            socket.on("newUser", function(user) {
                console.log(user);
                $("#currentUsers").append("<li>" + user + "</li>");
            })
            socket.on("getMessages", function(messages) {
                console.log('messages', messages);
                for (i = 0; i < messages.length; i++) {
                    $('#messages').append("<li>" + messages[i].user + ": " + messages[i].message + "</li>");
                }
            })
            socket.on("getUsers", function(people) {
                console.log("people", people);
                for (i = 0; i < people.length; i++) {
                    $('#currentUsers').append("<li>" + people[i] + "</li>");
                }
            })
        })
    </script>
</head>

<body>
    <div class="jumbotron text-center">
        <strong><h2>CS260 Chat</h2></strong>
    </div>
    <div style="display:flex; flex-direction:row;">
        <div style="flex:2; border: 2px solid">
            <h3>Messages</h3>
            <ul id="messages"></ul>
            <form id="messageSubmit" style="position: fixed; bottom: 10px; left:2%;">
                <input type="text" size=60 id="theMessage">
                <input type="submit" value="Send Message" />
            </form>
        </div>
        <div style="flex:1; border: 2px solid">
            <h3>Currently Online</h3>
            <ul id="currentUsers"></ul>
        </div>
        <div style="flex:1; border: 2px solid">
            <h3>User Activity</h3>
            <ul id="activityLog"></ul>
            <form id="userName" style="position: fixed; bottom:50%; top:50%">
                <input type="text" required placeholder="Enter a username for the chat" size=30; id="name";/>
                <input type="submit" value="Submit" />
            </form>
        </div>
    </div>
</body>

</html>
